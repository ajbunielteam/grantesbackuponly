<!DOCTYPE html>
<html>
<head>
    <title>Diagnostics</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>GranTES Diagnostics</h1>
    
    <div class="test-section">
        <h3>Test Database Connection</h3>
        <button onclick="testDB()">Test DB</button>
        <div id="db-result"></div>
    </div>

    <div class="test-section">
        <h3>Test Get Posts API</h3>
        <button onclick="testPosts()">Get Posts</button>
        <div id="posts-result"></div>
    </div>

    <div class="test-section">
        <h3>Test Update Engagement</h3>
        <input type="number" id="post-id" placeholder="Post ID" value="1">
        <button onclick="testLike()">Test Like</button>
        <button onclick="testComment()">Test Comment</button>
        <button onclick="testShare()">Test Share</button>
        <div id="engagement-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost/grantes/api';

        async function testDB() {
            try {
                const response = await fetch(API_BASE + '/get_posts.php');
                const text = await response.text();
                document.getElementById('db-result').innerHTML = '<pre>' + text + '</pre>';
            } catch (e) {
                document.getElementById('db-result').innerHTML = 'Error: ' + e.message;
            }
        }

        async function testPosts() {
            try {
                const response = await fetch(API_BASE + '/get_posts.php');
                const text = await response.text();
                document.getElementById('posts-result').innerHTML = '<pre>' + text + '</pre>';
            } catch (e) {
                document.getElementById('posts-result').innerHTML = 'Error: ' + e.message;
            }
        }

        async function testLike() {
            const postId = document.getElementById('post-id').value;
            await sendEngagement(postId, 'like');
        }

        async function testComment() {
            const postId = document.getElementById('post-id').value;
            await sendEngagement(postId, 'comment', 'Test comment from diagnostics');
        }

        async function testShare() {
            const postId = document.getElementById('post-id').value;
            await sendEngagement(postId, 'share');
        }

        async function sendEngagement(postId, action, comment = '') {
            const resultDiv = document.getElementById('engagement-result');
            try {
                const payload = { postId: parseInt(postId), action: action };
                if (comment) {
                    payload.comment = comment;
                    payload.author = 'Test User';
                }

                console.log('Sending:', payload);

                const response = await fetch(API_BASE + '/update_post_engagement.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const text = await response.text();
                console.log('Response text:', text);
                
                try {
                    const json = JSON.parse(text);
                    resultDiv.innerHTML = '<pre>' + JSON.stringify(json, null, 2) + '</pre>';
                } catch (e) {
                    resultDiv.innerHTML = '<pre>' + text + '</pre>';
                }
            } catch (e) {
                resultDiv.innerHTML = 'Error: ' + e.message;
                console.error(e);
            }
        }
    </script>
</body>
</html>

